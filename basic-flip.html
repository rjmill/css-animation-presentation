<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Basic FLIP Demo</title>
</head>
<body>
<style>
.transition-on-transforms {
  transition-property: transform;
  transition-duration: 1s;
  transition-timing-function: ease-in-out;
}
</style>

  <h3>To Do</h3>
  <ul id="todo-list">
    <li>friends</li>
    <li>romans</li>
    <li>countrymen</li>
    <li>lend my your ears</li>
    <li>I come to bury Caesar</li>
    <li>not to praise him</li>
  </ul>

  <h3>Done</h3>
  <ul id="done-list">
    <!-- nothing here yet -->
  </ul>

<script>
  const eleTodoList = document.querySelector('#todo-list');
  const eleDoneList = document.querySelector('#done-list');


  const flipOne = function(ele, first, last) {
    // invert
    let invert = first.top - last.top;

    // Apply a transformation to put it back to it's original location
    ele.style.transform = `translate(0, ${invert}px)`;

    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        ele.classList.add('transition-on-transforms');
        // Remove the transformation
        ele.style.transform = '';
        // TODO: clean up on transition end
      })
    })
  }

  const flipMany = function(eles, listFirst, listLast) {
    for (let i = 0; i < eles.length; i++) {
      let ele = eles[i];
      let first = listFirst[i];
      let last = listLast[i];
      flipOne(ele, first, last);
    }
  }

  const handleMarkDone = function(event) {
    let target = event.target;
    // EARLY RETURN
    if (target.tagName !== 'LI') {
      return; // skip if it's not a list item
    }
    let elesTodoItems = Array.from(
      document.querySelectorAll('#todo-list li')
    );

    // first
    let listFirst = elesTodoItems.map(ele => ele.getBoundingClientRect());

    eleDoneList.append(target);

    // last
    let listLast = elesTodoItems.map(ele => ele.getBoundingClientRect());

    flipMany(elesTodoItems, listFirst, listLast);
  }


  // init event listeners
  eleTodoList.addEventListener('click', handleMarkDone);
</script>
</body>
</html>
